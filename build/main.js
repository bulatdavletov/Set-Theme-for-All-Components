var m=Object.defineProperty,N=Object.defineProperties,S=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyDescriptors,P=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var d=(e,o,t)=>o in e?m(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,h=(e,o)=>{for(var t in o||(o={}))g.call(o,t)&&d(e,t,o[t]);if(u)for(var t of u(o))_.call(o,t)&&d(e,t,o[t]);return e},C=(e,o)=>N(e,v(o));var l=(e,o)=>()=>(e&&(o=e(e=0)),o);var M=(e,o)=>{for(var t in o)m(e,t,{get:o[t],enumerable:!0})},b=(e,o,t,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let s of P(o))!g.call(e,s)&&s!==t&&m(e,s,{get:()=>o[s],enumerable:!(n=S(o,s))||n.enumerable});return e};var U=e=>b(m({},"__esModule",{value:!0}),e);function p(e,o){if(typeof __html__=="undefined")throw new Error("No UI defined");let t=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof o=="undefined"?{}:o)};${__html__}</script>`;figma.showUI(t,C(h({},e),{themeColors:typeof e.themeColors=="undefined"?!0:e.themeColors}))}var x=l(()=>{});var y=l(()=>{x()});var T={};M(T,{default:()=>B});function B(){console.log("Plugin started"),p({width:240,height:320});function o(){if(figma.currentPage.selection.length===0){figma.ui.postMessage({type:"SELECTION_EMPTY",message:"Please select at least one layer"});return}let{themes:t,instanceCount:n,circularInstances:s}=L();console.log("Detected themes:",t),console.log("Instance count:",n),console.log("Circular instances:",s);let r=["Light","Dark"],a=Array.from(new Set([...r,...t]));console.log("Themes to use:",a),figma.ui.postMessage({type:"THEMES_AVAILABLE",themes:a,instanceCount:n,selectionCount:figma.currentPage.selection.length,circularInstances:s})}figma.ui.onmessage=t=>{if(t.type==="INIT"||t.type==="SELECTION_CHANGED")o();else if(t.type==="SUBMIT"){console.log("Applying theme:",t.formValues.theme);let n=t.formValues.theme,s=O(n);console.log("Updated instances count:",s.updatedCount),console.log("Circular instances in result:",s.circularInstances),console.log("Circular instances count:",s.circularInstances.length),figma.ui.postMessage({type:"THEME_APPLIED",updatedCount:s.updatedCount,skippedCount:s.skippedCount,circularInstances:s.circularInstances,theme:n})}else(t.type==="CLOSE"||t.type==="CANCEL")&&figma.closePlugin()},figma.on("selectionchange",()=>{o()}),setTimeout(()=>{o()},300)}function I(e){var s;if(!e.mainComponent)return!1;let o=e.mainComponent.id,t=(s=e.mainComponent.parent)==null?void 0:s.id,n=e.parent;for(;n;){if(n.type==="COMPONENT"&&n.id===o)return console.error("CIRCULAR REFERENCE DETECTED:",e.name,"is inside its own main component:",e.mainComponent.name),!0;if(n.type==="COMPONENT_SET"&&n.id===t)return console.log("Ignoring instance from same component set:",e.name),!1;n=n.parent}return!1}function L(){let e=new Set,o=0,t=0,n=[];function s(r){if(r.type==="INSTANCE"){if(o++,console.log("Instance found:",r.name),r.mainComponent&&(console.log("Main component:",r.mainComponent.name),I(r))){console.error("Skipping theme detection for circular instance:",r.name),n.push({name:r.name,id:r.id});return}try{let a=r.componentProperties;if(a&&"Theme"in a){t++;let i=a.Theme;if(i&&i.type==="VARIANT"){i.value&&typeof i.value=="string"&&e.add(i.value);try{let c=r.mainComponent;if(c&&c.variantProperties&&"Theme"in c.variantProperties){let f=c.variantProperties.Theme;Array.isArray(f)&&f.forEach(E=>{e.add(E)})}}catch(c){console.error("Error accessing main component properties:",c)}}}}catch(a){console.error("Error processing instance:",a)}}if("children"in r)for(let a of r.children)s(a)}return figma.currentPage.selection.forEach(r=>s(r)),console.log(`Found ${o} instances, ${t} with Theme property`),{themes:Array.from(e),instanceCount:t,circularInstances:n}}function O(e){let o=0,t=0,n=[];function s(r){if(r.type==="INSTANCE"){if(console.log("Checking instance for update:",r.name),I(r)){console.error("Skipping update for circular instance:",r.name),n.push({name:r.name,id:r.id}),console.log("Added circular instance to list:",r.name,"Total:",n.length),t++;return}try{let a=r.componentProperties;if(a&&"Theme"in a){let i=a.Theme;if(i&&i.type==="VARIANT")try{console.log("Updating theme for node:",r.name),r.setProperties({Theme:e}),o++}catch(c){console.error("Error updating theme for node:",r.name,c),t++}}}catch(a){console.error("Error processing instance for theme update:",a)}}if("children"in r)for(let a of r.children)s(a)}return figma.currentPage.selection.forEach(r=>s(r)),console.log("Final circular instances count:",n.length),console.log("Circular instances:",n),{updatedCount:o,skippedCount:t,circularInstances:n}}var A=l(()=>{"use strict";y()});var D={"src/main.ts--default":(A(),U(T)).default},F="src/main.ts--default";D[F]();
