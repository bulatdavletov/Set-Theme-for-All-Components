var d=Object.defineProperty,w=Object.defineProperties,M=Object.getOwnPropertyDescriptor,L=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var I=(o,t,e)=>t in o?d(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,A=(o,t)=>{for(var e in t||(t={}))N.call(t,e)&&I(o,e,t[e]);if(T)for(var e of T(t))b.call(t,e)&&I(o,e,t[e]);return o},E=(o,t)=>w(o,L(t));var h=(o,t)=>()=>(o&&(t=o(o=0)),t);var U=(o,t)=>{for(var e in t)d(o,e,{get:t[e],enumerable:!0})},B=(o,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of _(t))!N.call(o,s)&&s!==e&&d(o,s,{get:()=>t[s],enumerable:!(n=M(t,s))||n.enumerable});return o};var D=o=>B(d({},"__esModule",{value:!0}),o);function y(o,t){if(typeof __html__=="undefined")throw new Error("No UI defined");let e=`<div id="create-figma-plugin"></div><script>document.body.classList.add('theme-${figma.editorType}');const __FIGMA_COMMAND__='${typeof figma.command=="undefined"?"":figma.command}';const __SHOW_UI_DATA__=${JSON.stringify(typeof t=="undefined"?{}:t)};${__html__}</script>`;figma.showUI(e,E(A({},o),{themeColors:typeof o.themeColors=="undefined"?!0:o.themeColors}))}var k=h(()=>{});var P=h(()=>{k()});var S={};U(S,{default:()=>O});async function O(){if(console.log("Plugin started"),figma.command){if(console.log("Plugin launched with command:",figma.command),figma.command==="apply-dark-theme"){let e=await g("Dark");e.updatedCount>0?figma.notify(`\u2705 Updated ${e.updatedCount} / ${e.skippedCount+e.updatedCount}`):e.skippedCount>0&&figma.notify("\u{1F31A} Everything already Dark"),figma.closePlugin();return}else if(figma.command==="apply-light-theme"){let e=await g("Light");e.updatedCount>0?figma.notify(`\u2705 Updated ${e.updatedCount}/${e.skippedCount+e.updatedCount}`):e.skippedCount>0&&figma.notify("\u2600\uFE0F Everything already Light"),figma.closePlugin();return}}y({width:240,height:320});async function t(){if(console.log("Updating themes from selection"),figma.currentPage.selection.length===0){console.log("No selection"),figma.ui.postMessage({type:"NO_SELECTION"});return}let e=await R(),n=["Light","Dark"];figma.ui.postMessage({type:"THEMES_AVAILABLE",themes:n,instanceCount:e.instanceCount,circularInstances:e.circularInstances,checkedLayersCount:e.checkedLayersCount})}figma.ui.onmessage=async e=>{if(e.type==="SUBMIT"){console.log("Applying theme:",e.theme);let n=await $(e.theme);figma.ui.postMessage({type:"RESULTS",theme:e.theme,updatedCount:n.updatedCount,skippedCount:n.skippedCount,circularInstances:n.circularInstances,checkedLayersCount:n.checkedLayersCount})}else e.type==="INIT"||e.type==="SELECTION_CHANGED"?await t():e.type==="CANCEL"&&figma.closePlugin()},figma.on("run",async({command:e})=>{if(e==="apply-dark-theme"){console.log("Running command: Set Dark Theme to All");let n=await g("Dark");n.updatedCount>0?figma.notify(`\u2705 Updated ${n.updatedCount}/${n.updatedCount+n.skippedCount}`,{timeout:3e3}):n.skippedCount>0&&figma.notify("\u{1F31A} Everything already Dark",{timeout:3e3}),figma.closePlugin()}else if(e==="apply-light-theme"){console.log("Running command: Set Light Theme to All");let n=await g("Light");n.updatedCount>0?figma.notify(`\u2705 Updated ${n.updatedCount}/${n.updatedCount+n.skippedCount}`,{timeout:3e3}):n.skippedCount>0&&figma.notify("\u2600\uFE0F Everything already Light",{timeout:3e3}),figma.closePlugin()}}),(async()=>await t())(),figma.on("selectionchange",async()=>{await t()})}async function C(o){var t;try{let e=await o.getMainComponentAsync();if(!e)return!1;let n=e.id,s=(t=e.parent)==null?void 0:t.id,r=o.parent;for(;r;){if(r.type==="COMPONENT"&&r.id===n)return console.log("Circular reference detected:",o.name,"is inside its own main component"),!0;if(r.type==="COMPONENT_SET"&&r.id===s)return console.log("Ignoring instance from same component set:",o.name),!1;if(r.type==="INSTANCE"){let c=await r.getMainComponentAsync();if(c&&c.parent&&c.parent.id===s)return console.log("Potential cycle detected: Instance nested inside another instance from the same component set:",o.name),!0}r=r.parent}return!1}catch(e){return console.log("Error checking for circular reference:",e),!1}}async function R(){let o=0,t=0,e=0,n=[];async function s(r){if(e++,console.log("Checking layer:",r.name,"Type:",r.type),r.type==="INSTANCE"){o++,console.log("Instance found:",r.name);try{let c=await r.getMainComponentAsync();if(c&&(console.log("Main component:",c.name),await C(r))){console.error("Skipping theme detection for circular instance:",r.name),n.push({name:r.name,id:r.id});return}}catch(c){console.log("Error getting main component:",c)}try{let c=r.componentProperties;if(c&&"Theme"in c){let l=c.Theme;if(l&&l.type==="VARIANT"){l.value&&l.value;try{let p=await r.getMainComponentAsync();if(p&&p.variantProperties&&"Theme"in p.variantProperties){let a=p.variantProperties.Theme;Array.isArray(a)&&a.forEach(i=>{})}}catch(p){console.log("Error getting theme values:",p)}}}}catch(c){console.log("Error checking component properties:",c)}}if("children"in r)for(let c of r.children)await s(c)}for(let r of figma.currentPage.selection)await s(r);return console.log(`Found ${o} instances, ${t} with Theme property, checked ${e} layers total`),{instanceCount:t,circularInstances:n,checkedLayersCount:e}}async function $(o){let t=0,e=0,n=0,s=0,r=0,c=[],l=0;figma.currentPage.selection.forEach(i=>{p(i)});function p(i){if(l++,"children"in i)for(let m of i.children)p(m)}console.log("Estimated total nodes to process:",l),figma.ui.postMessage({type:"PROGRESS_UPDATE",checked:0,total:l,updated:0,skipped:0,instances:0});async function a(i){if(n++,console.log("Checking layer:",i.name,"Type:",i.type),i.type==="INSTANCE"){s++,console.log("Instance found:",i.name);try{let m=await i.getMainComponentAsync();if(m&&(console.log("Main component:",m.name),await C(i))){console.error("Skipping theme detection for circular instance:",i.name),c.push({name:i.name,id:i.id});return}}catch(m){console.log("Error getting main component:",m)}try{let m=i.componentProperties;if(m&&"Theme"in m){let u=m.Theme;if(u&&u.type==="VARIANT"){u.value&&u.value;try{let f=await i.getMainComponentAsync();if(f&&f.variantProperties&&"Theme"in f.variantProperties){let x=f.variantProperties.Theme;Array.isArray(x)&&x.forEach(H=>{})}}catch(f){console.log("Error getting theme values:",f)}}}}catch(m){console.log("Error checking component properties:",m)}}if("children"in i)for(let m of i.children)await a(m)}for(let i of figma.currentPage.selection)await a(i);return figma.ui.postMessage({type:"PROGRESS_UPDATE",checked:n,total:l,updated:t,skipped:e,instances:s,isComplete:!0}),console.log("Final circular instances count:",c.length),console.log("Circular instances:",c),console.log("Checked layers count:",n),console.log("Total instances count:",s),{updatedCount:t,skippedCount:e,circularInstances:c,checkedLayersCount:n}}async function g(o){let t=0,e=0,n=0,s=0,r=[],c=0;figma.currentPage.selection.forEach(a=>{l(a)});function l(a){if(c++,"children"in a)for(let i of a.children)l(i)}console.log("Estimated total nodes to process:",c);async function p(a){if(n++,console.log("Checking layer:",a.name,"Type:",a.type),a.type==="INSTANCE")if(s++,console.log("Checking instance for update:",a.name),await C(a))console.error("Skipping update for circular instance:",a.name),r.push({name:a.name,id:a.id}),console.log("Added circular instance to list:",a.name,"Total:",r.length),e++;else try{let i=a.componentProperties;if(i&&"Theme"in i){let m=i.Theme;if(m&&m.type==="VARIANT")if(m.value===o)console.log("Instance already has the desired theme:",a.name),e++;else try{console.log("Updating theme for node:",a.name);try{a.setProperties({Theme:o}),t++}catch(u){u.message&&u.message.includes("cycle")?(console.log("Cycle error detected when updating theme for:",a.name,"- Skipping this instance"),r.push({name:a.name,id:a.id})):console.error("Error updating theme for node:",a.name,u),e++}}catch(u){console.error("Error updating theme for node:",a.name,u),e++}}}catch(i){console.error("Error processing instance for theme update:",i)}if("children"in a)for(let i of a.children)await p(i)}for(let a of figma.currentPage.selection)await p(a);return console.log("Final circular instances count:",r.length),console.log("Circular instances:",r),console.log("Checked layers count:",n),console.log("Total instances count:",s),{updatedCount:t,skippedCount:e,circularInstances:r,checkedLayersCount:n}}var v=h(()=>{"use strict";P()});var F={"src/main.ts--default":(v(),D(S)).default},V="src/main.ts--default";F[V]();
